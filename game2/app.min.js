function game(){let e=document.getElementById("app"),t=document.createElement("canvas");e.append(t),t.id="render-canvas";let s=document.createElement("p");e.append(s),s.id="coin-score",s.classList.add("a-pos"),s.textContent=0;let o=document.createElement("div");e.append(o),o.id="health",o.classList.add("a-pos");let i=document.createElement("img");o.append(i),i.src="assets/heart.svg",i.classList.add("a-pos");let a=document.createElement("div");e.append(a),a.id="shield",a.classList.add("a-pos");let n=document.createElement("img");a.append(n),n.src="assets/shield.svg",n.classList.add("a-pos");let r=new BABYLON.Engine(t),$=new BABYLON.Scene(r);$.clearColor=new BABYLON.Color3(.3,.3,.3),$.enablePhysics(),$.createDefaultEnvironment({createSkybox:!1,createGround:!1,cameraContrast:2.5,cameraExposure:1});let p=new BABYLON.MeshBuilder.CreateBox("skyBox",{size:7e3},$),l=new BABYLON.StandardMaterial("skyBox",$);l.reflectionTexture=new BABYLON.CubeTexture("assets/environment/Space",$),l.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,l.backFaceCulling=!1,p.material=l;let d=new BABYLON.FollowCamera("FollowCam",BABYLON.Vector3.Zero(),$);d.radius=-20,d.heightOffset=3;let c=new BABYLON.PointLight("light",new BABYLON.Vector3(10,10,0),$);c.intensity=.25;let y=new BABYLON.ShadowGenerator(1024,c),m=[],h=[],_,w=100,x=200,u=0,g=!0,C={x:0,y:0,z:0},S=Math.PI/180,z=!1,k,b=(e,t)=>Math.floor(Math.random()*(t-e+1)+e);BABYLON.SceneLoader.ImportMesh(null,"assets/tie/","scene.gltf",$,e=>{(_=e[0]).position=new BABYLON.Vector3(0,0,0),y.addShadowCaster(_),_.receiveShadows=!0,_.yPos=0,d.lockedTarget=_,_.scaling=new BABYLON.Vector3(.003,.003,.003)});let E=()=>{let e=new BABYLON.MeshBuilder.CreateSphere("sphere",$);e.position=_?new BABYLON.Vector3(_.position.x+b(-100,100),_.position.y+b(-100,100),_.position.z+b(-100,100)):new BABYLON.Vector3(b(-100,100),b(-100,100),b(-100,100));let t=new BABYLON.StandardMaterial("material",$);t.emissiveTexture=new BABYLON.Texture(.5>Math.random()?"assets/met.webp":"assets/met.jpg"),e.material=t,y.getShadowMap().renderList.push(e),e.physicsImpostor=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.SphereImpostor,{mass:0},$),e.destroy=()=>{e.material.emissiveTexture=new BABYLON.Texture("assets/fire.jpg"),e.material.alpha=.7,e.scaling=new BABYLON.Vector3(2,2,2),setTimeout(()=>{e.dispose()},750)},e.s=b(1,3)/10,m.push(e)},v=(e,t,s)=>{if(_&&!z){z=!0;let o=new BABYLON.MeshBuilder.CreateCapsule("capsule",{radius:.06,height:2,orientation:new BABYLON.Vector3(0,0,1)});o.rotation.y=_.rotation.y,o.material=new BABYLON.StandardMaterial("material",$),o.material.emissiveColor=new BABYLON.Color3(0,1,0),o.position=new BABYLON.Vector3(_.position.x,_.position.y+.1,_.position.z),o.xSpeed=e,o.ySpeed=t,o.zSpeed=s,h.push(o),setTimeout(()=>{z=!1},550)}},f=e=>{w-e>=0?w-=e:(x-=e-w,w=0),x<=0&&(g=!1)},M=()=>{(k=new BABYLON.MeshBuilder.CreateSphere("sphere",$)).position=_.position,k.material=new BABYLON.StandardMaterial("material",$),k.material.emissiveTexture=new BABYLON.Texture("assets/shield.jpg"),k.physicsImpostor=new BABYLON.PhysicsImpostor(k,BABYLON.PhysicsImpostor.SphereImpostor,{mass:0},$),k.material.alpha=.4,k.scaling=new BABYLON.Vector3(5,4.2,4.5),k.xRot=0,k.yRot=0,k.zRot=0,k.destroy=()=>{k.dispose(),k=null}};$.registerBeforeRender(()=>{k&&(k.xRot+=.23,k.xRot+=.3,k.xRot+=.27,k.rotation=new BABYLON.Vector3(k.xRot,k.yRot,k.zRot),k.position=_.position),h.forEach((e,t)=>{e.position.x+=e.xSpeed,e.position.y+=e.ySpeed,e.position.z+=e.zSpeed,_&&(Math.abs(e.position.x-_.position.x)>100||Math.abs(e.position.y-_.position.y)>100||Math.abs(e.position.z-_.position.z)>100)&&(e.dispose(),h.splice(t,1))});for(let e=0;e<=200-m.length;e++)E();m.forEach((e,t)=>{_&&(3>Math.abs(e.position.x-_.position.x)&&3>Math.abs(e.position.y-_.position.y)&&3>Math.abs(e.position.z-_.position.z)&&(e.destroy(),m.splice(t,1),k||f(100)),(Math.abs(e.position.x-_.position.x)>100||Math.abs(e.position.y-_.position.y)>100||Math.abs(e.position.z-_.position.z)>100)&&(e.dispose(),m.splice(t,1))),h.forEach((s,o)=>{e.intersectsMesh(s,!0)&&(s.dispose(),h.splice(o,1),u++,e.destroy(),m.splice(t,1))})}),_&&(_.position.x+=.05*Math.sin(C.y),_.position.y=_.yPos,_.position.z+=.05*Math.cos(C.y),_.rotation=new BABYLON.Vector3(C.x,C.y,C.z)),s.textContent=u,o.style.width=`${x}px`,a.style.width=`${w}px`}),r.runRenderLoop(()=>{g?$.render():e.innerHTML=null}),window.addEventListener("keydown",e=>{switch(console.log(e.keyCode),e.keyCode){case 37:C.y-=S,C.z=20*S;break;case 39:C.y+=S,C.z=-20*S;break;case 38:_.yPos+=.1,C.x=-7*S;break;case 40:_.yPos-=.1,C.x=7*S;break;case 16:_&&(k?k.destroy():M())}}),window.addEventListener("keyup",e=>{(37===e.keyCode||39===e.keyCode)&&(C.z=0),(38===e.keyCode||40===e.keyCode)&&(C.x=0)}),window.addEventListener("keypress",e=>{32===e.keyCode&&v(Math.sin(C.y),0,Math.cos(C.y))})}game();